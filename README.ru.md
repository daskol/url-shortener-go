# url-shortener-go

*Простой укротитель ссылок на Go*

## Описание

[*Read in english here.*](README.md)

Укоротитель ссылок предоставляет два типа хранилищ ссылок. Первый оборачивает структуру встроенную структуру данных `map`, делая её потокобезопасный. К сожалению, данная реализация не гарантирует надёжного хранения. Поэтому был добавлен второе хранилище на основе [Bolt DB](https://github.com/boltdb/bolt), когда персистентность хранения является основным требованием. Ниже приведены гарантии и свойства реализации.

1. Потокобезопасность при укорачивании нового URL.
2. Время жизни ссылок и базовый URL являются параметром.
3. Конфигурация может быть загружена из [toml-файла](etc/url-shortener.toml).
4. Два типа хранилищ ссылок.
5. Гарантируется персистентность укороченных ссылок с хранилищем на Bolt DB.
6. Правильная работа за прокси или балансерами.

Чтобы развернуть `url-shortener-go` самому c персистентным хранением ссылок достаточно выполнить
```bash
    ./url-shortener --url-storage bolt
```
Либо зарегистрировать как системный сервис, описанный в [systemd unit-файле](etc/url-shortener-go.service), и запустить его.

[Попробовать здесь.](https://daskol.xyz/shorten/)

### Методы API

Новый короткий URL создаётся простым запросом к серверу на URI `/shorten/` с параметром `url`, который содержит укорачиваемый URL.
```bash
    curl -v -X POST http://localhost:8080/shorten/?url=https://google.com
```
На запрос приходит ответ с кодом 201(Created) и короткий URL в заговке `Location`, который дублируется в теле ответа.

При выполнении запроса на возвращённую короткую ссылку приходит ответ с кодом 302(Found/Moved Temporary) с установленным заголовком `Location`, указывающим на оригинальный URL.
```bash
    curl -v http://localhost:8080/ri0xJwQ6
```
